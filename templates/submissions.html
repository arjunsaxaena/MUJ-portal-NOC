<!-- templates/submissions.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reviewer Submissions</title>
</head>
<body>
    <h1>Submissions for Review</h1>
    <p>Welcome, <span id="reviewerEmail"></span>! Here are the submissions for your department.</p>

    <button onclick="logout()">Logout</button>

    <h2>Submissions</h2>
    <table border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>Student Name</th>
                <th>Department</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="submissionsTable">
            <!-- Submissions will be loaded here -->
        </tbody>
    </table>

    <script>
        // Function to check if a user is authenticated (i.e., has a JWT token)
        function isAuthenticated() {
            const token = localStorage.getItem('jwt_token');
            return token && token.length > 0;
        }

        // Function to fetch and display the submissions
        function loadSubmissions() {
            const token = localStorage.getItem('jwt_token');
            if (!token) {
                window.location.href = '/reviewer/login'; // Redirect to login if no token
                return;
            }

            fetch('/reviewer/submissions', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`, // Pass JWT token in the Authorization header
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.submissions) {
                    const submissionsTable = document.getElementById('submissionsTable');
                    submissionsTable.innerHTML = ''; // Clear any previous data
                    data.submissions.forEach(submission => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${submission.id}</td>
                            <td>${submission.studentName}</td>
                            <td>${submission.department}</td>
                            <td>${submission.status}</td>
                            <td><button onclick="viewSubmission(${submission.id})">View</button></td>
                        `;
                        submissionsTable.appendChild(row);
                    });
                } else {
                    alert("Error fetching submissions.");
                }
            })
            .catch(error => {
                console.error('Error fetching submissions:', error);
            });
        }

        // Function to view a specific submission (you can extend this functionality as needed)
        function viewSubmission(submissionId) {
            alert("Viewing submission with ID: " + submissionId);
            // You can expand this function to fetch and display detailed information about the submission
        }

        // Function to log out (clear the JWT token)
        function logout() {
            localStorage.removeItem('jwt_token');
            window.location.href = '/reviewer/login';
        }

        // Load submissions on page load
        window.onload = function() {
            if (isAuthenticated()) {
                const email = localStorage.getItem('reviewerEmail'); // You can also store reviewer email in localStorage after login
                document.getElementById('reviewerEmail').textContent = email;
                loadSubmissions();
            } else {
                window.location.href = '/reviewer/login';
            }
        };
    </script>
</body>
</html>
